@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}



<!-- BEGIN PAGE CONTENT-->
<div class="row">
    <div class="col-md-12">
        <!-- BEGIN SAMPLE FORM PORTLET-->
        <div class="portlet box blue">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-gift"></i> 记录表单
                </div>
                <div class="tools">
                    <a href="" class="collapse" data-original-title="" title="">
                    </a>
                    <a href="#portlet-config" data-toggle="modal" class="config" data-original-title="" title="">
                    </a>
                    <a href="" class="reload" data-original-title="" title="">
                    </a>
                    <a href="" class="remove" data-original-title="" title="">
                    </a>
                </div>
            </div>
            <div class="portlet-body form">
                <form role="form" id="formRemember">
                    <div class="form-body">

                        <div class="form-group">
                            <label>信息</label>
                            <div class="input-icon">
                                <i class="fa fa-file-o"></i>
                                <input type="text" class="form-control" placeholder="标题" name="InfoName">
                                <input class="hidden" type="text" name="ID">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>内容</label>
                            <textarea class="form-control" rows="3" name="InfoContent"></textarea>
                        </div>
                    </div>
                    <div class="form-actions text-center">
                        <button type="submit" class="btn blue">保存</button>
                        <button type="button" class="btn default">取消</button>
                    </div>
                </form>
            </div>
        </div>
        <!-- END SAMPLE FORM PORTLET-->

    </div>


</div>
<div class="row">
    <div class="col-md-12">
        <!-- BEGIN SAMPLE TABLE PORTLET-->
        <div class="portlet box red">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-cogs"></i>记录列表
                </div>
                <div class="tools">
                    <a href="javascript:;" class="collapse" data-original-title="" title="">
                    </a>
                    <a href="#portlet-config" data-toggle="modal" class="config" data-original-title="" title="">
                    </a>
                    <a href="javascript:;" class="reload" data-original-title="" title="">
                    </a>
                    <a href="javascript:;" class="remove" data-original-title="" title="">
                    </a>
                </div>
            </div>
            <div class="portlet-body">
                <table id="tabRemember" class="table table-striped table-bordered table-hover">
                    <thead>
                        <tr>
                            <th>
                                ID
                            </th>
                            <th>
                                InfoName
                            </th>
                            <th>
                                InfoContent
                            </th>
                            <th>
                                CreateDate
                            </th>
                            <th>
                                AlertDate1
                            </th>
                            <th>
                                AlertDate2
                            </th>
                            <th>
                                AlertDate3
                            </th>
                            <th>
                                AlertDate4
                            </th>
                            <th>
                                AlertDate5
                            </th>
                            <th>
                                Delete
                            </th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        <!-- END SAMPLE TABLE PORTLET-->
    </div>
</div>
<script src="~/assets/global/plugins/datatables/all.min.js"></script>
<!-- END PAGE CONTENT-->
<script>
    $(function () {
        bindTable();
       

        $('#formRemember').submit(function () {
            $.ajax({
                url: "/EasyRemember/SubmitForm",
                type: "post",
                data: $("#formRemember").serialize(),
                success: function (result) {
                    if (result == "0") {
                        alert("出错");
                    } else {
                        $("#formRemember")[0].reset();
                        bindTable();
                    }
                }
            });
            return false;
        });
        

   
    });
    function bindTable() {
        
        $.ajax({
            url: "/EasyRemember/GetDataList",
            type: "post",
            data: "",
            success: function (result) {
                $("#tabRemember tbody").html("");
                var list = JSON.parse(result);
                for (var i = 0; i < list.rowcount; i++) {
                    var tr = $("<tr id='tr"+list.rows[i].ID+"'>"
                      + "<td>" + list.rows[i].ID + "</td>"
                      + "<td>" + list.rows[i].InfoName + "</td>"
                      + "<td>" + list.rows[i].InfoContent + "</td>"
                      + "<td>" + '<span class="label label-sm label-success">' + list.rows[i].CreateDate + '</span>' + "</td>"
                      + "<td>" + '<span class="label label-sm label-info">' + list.rows[i].AlertDate1 + '</span>' + "</td>"
                      + "<td>" + '<span class="label label-sm label-warning">' + list.rows[i].AlertDate2 + '</span>' + "</td>"
                      + "<td>" + '<span class="label label-sm label-danger">' + list.rows[i].AlertDate3 + '</span>' + "</td>"
                      + "<td>" + list.rows[i].AlertDate4 + "</td>"
                      + "<td>" + list.rows[i].AlertDate5 + "</td>"
                  
                      + "<td>"
                      + '<a class="btn-small red" onclick="deleteOne(' + list.rows[i].ID + ')"><i class="fa fa-times"></i>Delete</a><br/>'
                      + '<a class="btn-small red" onclick="editOne(' + list.rows[i].ID + ')"><i class="fa fa-edit"></i>Edit</a>'
                      + "</td>"
                      + "</tr>");
                   
                    tr.appendTo($("#tabRemember tbody"));
                }
                $("#tabRemember").dataTable();


            },
            error: function (result) {
                alert(result);
            }
        });

    }
    function editOne(id) {
        var tds = $("#tr" + id).find("td");
        var infoName = $(tds[1]).html();
        var infoContent = $(tds[2]).html();
        $("#formRemember input[name='InfoName']").val(infoName);
        $("#formRemember input[name='ID']").val(id);
        $("#formRemember textarea[name='InfoContent']").val(infoContent);

    }
    function deleteOne(id) {
        $.ajax({
            url: "/EasyRemember/DeleteOne",
            type: "post",
            data: { ID: id },
            success: function (result) {
                //console.log(result);
                if (result == "1") {
                    bindTable();
                }
                else {
                    alert(result);
                }
            },
            error: function (result) {
                alert(result);
            }
        });
    }

</script>



